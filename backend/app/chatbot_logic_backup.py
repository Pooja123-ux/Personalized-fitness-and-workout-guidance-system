"""DynamicIntelligentFitnessChatbotLogicwithLLaMA3IntegrationCananswerANYquestionaboutANYattributeinANYdatasetwithouthardcodedpatternsEnhancedwithMetaAILLaMA3viaOllamaforintelligentresponses"""importpandasaspdimportreimportjsonfromtypingimportDict,List,Any,Optional,Tuple,UnionimportnumpyasnpfromdatetimeimportdatetimeimportrequestsimportasyncioclassFitnessChatbot:def__init__(self,use_llama=False,ollama_url="http://localhost:11434"):"""InitializethedynamicchatbotwithalldatasetsandoptionalLLaMA3"""self.use_llama=use_llamaself.ollama_url=ollama_urlself.llama_model="llama3"self.datasets={}self.dataset_metadata={}self.load_all_datasets()self.build_dataset_metadata()#TestOllamaconnectionifLLaMAisenabledifself.use_llama:self.test_ollama_connection()deftest_ollama_connection(self):"""TestconnectiontoOllamaserver"""try:response=requests.get(f"{self.ollama_url}/api/tags",timeout=5)ifresponse.status_code==200:models=response.json().get('models',[])model_names=[model['name']formodelinmodels]ifself.llama_modelinmodel_names:print(f"✅LLaMA3connectedsuccessfullyviaOllama")returnTrueelse:print(f"⚠️LLaMA3modelnotfound.Availablemodels:{model_names}")self.use_llama=FalsereturnFalseelse:print(f"⚠️Ollamaservernotresponding.Usingdataset-onlymode.")self.use_llama=FalsereturnFalseexceptExceptionase:print(f"⚠️CouldnotconnecttoOllama:{e}.Usingdataset-onlymode.")self.use_llama=FalsereturnFalsedefcall_llama3(self,prompt:str,context:Dict[str,Any]=None)->str:"""CallLLaMA3viaOllamaAPI"""ifnotself.use_llama:returnNonetry:#Buildcontext-awarepromptcontext_info=""ifcontextandcontext.get('dataset_results'):context_info=f"\n\nDatasetResults:\n{context['dataset_results']}\n"enhanced_prompt=f"""Youareahelpfulfitnessandnutritionassistant.Youhaveaccesstocomprehensivefitnessdatasets.Usetheprovideddatasetinformationtoansweraccuratelyandprofessionally.UserQuestion:{prompt}{context_info}Pleaseprovideahelpful,accurateresponsebasedonthedatasetinformation.Ifthedatasetdoesn'tcontainrelevantinformation,saysopolitely.Keepresponsesconciseandfocused."""#CallOllamaAPIresponse=requests.post(f"{self.ollama_url}/api/generate",json={"model":self.llama_model,"prompt":enhanced_prompt,"stream":False,"options":{"temperature":0.3,"top_p":0.9,"max_tokens":500}},timeout=30)ifresponse.status_code==200:result=response.json()returnresult.get('response','').strip()else:print(f"⚠️LLaMA3APIerror:{response.status_code}")returnNoneexceptExceptionase:print(f"⚠️LLaMA3callfailed:{e}")returnNonedefload_all_datasets(self):"""LoadallCSVdatasetsdynamically"""try:#Loadalldatasetsself.datasets['exercises']=pd.read_csv('app/exercises.csv')self.datasets['indian_food']=pd.read_csv('app/Indian_Food_Nutrition_Processed.csv')self.datasets['diet_recommendations']=pd.read_csv('app/diet_recommendations_dataset.csv')self.datasets['disease_food']=pd.read_csv('app/real_disease_food_nutrition_dataset.csv')self.datasets['yoga_poses']=pd.read_csv('app/final_asan1_1.csv')print("Alldatasetsloadedsuccessfully!")exceptExceptionase:print(f"Errorloadingdatasets:{e}")self.datasets={}defbuild_dataset_metadata(self):"""Buildmetadataaboutalldatasetsfordynamicquerying"""forname,dfinself.datasets.items():self.dataset_metadata[name]={'columns':list(df.columns),'dtypes':df.dtypes.to_dict(),'num_rows':len(df),'numeric_columns':df.select_dtypes(include=[np.number]).columns.tolist(),'text_columns':df.select_dtypes(include=['object']).columns.tolist(),'sample_data':df.head(3).to_dict('records')}defextract_query_intent(self,question:str)->Dict[str,Any]:"""ExtractintentandentitiesfromthequestionusingNLP-likeanalysis"""question_lower=question.lower()intent={'question_type':None,'target_dataset':None,'target_column':None,'target_value':None,'operation':None,'keywords':[],'numbers':self.extract_numbers(question),'comparisons':self.extract_comparisons(question_lower)}#Extractkeywordsintent['keywords']=self.extract_keywords(question_lower)#Determinetargetdatasetintent['target_dataset']=self.identify_target_dataset(question_lower,intent['keywords'])#Determineoperationtypeintent['operation']=self.identify_operation(question_lower)#Extracttargetvalue/entityintent['target_value']=self.extract_target_value(question_lower,intent['target_dataset'])returnintentdefextract_numbers(self,text:str)->List[float]:"""Extractallnumbersfromtext"""numbers=re.findall(r'[\d.]+',text)return[float(n)forninnumbers]defextract_comparisons(self,text:str)->List[str]:"""Extractcomparisonoperators"""comparisons=[]ifany(wordintextforwordin['highest','most','maximum','max','top']):comparisons.append('highest')ifany(wordintextforwordin['lowest','least','minimum','min','bottom']):comparisons.append('lowest')ifany(wordintextforwordin['greaterthan','morethan','above','over','>']):comparisons.append('greater_than')ifany(wordintextforwordin['lessthan','below','under','<']):comparisons.append('less_than')ifany(wordintextforwordin['equalto','equals','exactly','=']):comparisons.append('equals')returncomparisonsdefextract_keywords(self,text:str)->List[str]:"""Extractmeaningfulkeywordsfromtext"""#Commonfitness/healthkeywordsall_keywords=set()#Addallcolumnnamesaskeywordsformetadatainself.dataset_metadata.values():all_keywords.update([col.lower()forcolinmetadata['columns']])#Addcommonfitnesstermsfitness_terms=['squat','deadlift','bench','press','curl','lift','row','pull','push','chest','back','legs','arms','shoulders','abs','core','glutes','hamstrings','protein','calories','carbs','fat','fiber','vitamin','mineral','diabetes','hypertension','heart','bloodpressure','cholesterol','yoga','pose','meditation','stretching','flexibility','weightloss','weightgain','musclegain','diet','nutrition']all_keywords.update(fitness_terms)#Extractkeywordsfromquestionquestion_words=text.split()found_keywords=[wordforwordinquestion_wordsifwordinall_keywords]#Alsoaddmulti-wordphrasesphrases=[]foriinrange(len(question_words)):forjinrange(i+1,min(i+4,len(question_words))):#2-3wordphrasesphrase=''.join(question_words[i:j+1])ifphraseinall_keywordsorany(keywordinphraseforkeywordinall_keywords):phrases.append(phrase)returnlist(set(found_keywords+phrases))defidentify_target_dataset(self,text:str,keywords:List[str])->Optional[str]:"""Identifywhichdatasetthequestionisabout"""#Dataset-specifickeywordmatching-checkthisfirstifany(kwintextforkwin['exercise','workout','muscle','fitness','gym','training','squat','bench','deadlift','press']):return'exercises'elifany(kwintextforkwin['calorie','protein','carb','fat','nutrition','food','eat','eating','healthy','recommend','suggest']):return'indian_food'elifany(kwintextforkwin['diet','weightloss','weightgain','musclegain']):return'diet_recommendations'elifany(kwintextforkwin['disease','diabetes','hypertension','health']):return'disease_food'elifany(kwintextforkwin['yoga','pose','asana','meditation']):return'yoga_poses'#Ifnospecifickeywords,tryscoringwithavailablekeywordsdataset_scores={}fordataset_name,metadatainself.dataset_metadata.items():score=0#Checkagainstcolumnnamesforkeywordinkeywords:forcolinmetadata['columns']:ifkeywordincol.lower()orcol.lower()inkeyword:score+=2#Checkagainstsampledataforrecordinmetadata['sample_data']:forcol,valinrecord.items():ifpd.notna(val)andisinstance(val,str):forkeywordinkeywords:ifkeywordinval.lower()orval.lower()inkeyword:score+=1dataset_scores[dataset_name]=score#Returndatasetwithhighestscoreifdataset_scores:best_dataset=max(dataset_scores,key=dataset_scores.get)ifdataset_scores[best_dataset]>0:returnbest_dataset#Defaultfallback-trytoguessbasedoncommontermstext_lower=text.lower()ifany(termintext_lowerfortermin['squat','bench','deadlift','press','curl','lift']):return'exercises'elifany(termintext_lowerfortermin['calories','protein','food','nutrition']):return'indian_food'returnNonedefidentify_operation(self,text:str)->str:"""Identifythetypeofoperationrequested"""ifany(wordintextforwordin['show','list','what','which','tellme','giveme']):return'retrieve'elifany(wordintextforwordin['count','howmany','numberof']):return'count'elifany(wordintextforwordin['average','mean','avg']):return'average'elifany(wordintextforwordin['sum','total']):return'sum'elifany(wordintextforwordin['maximum','highest','most','top']):return'max'elifany(wordintextforwordin['minimum','lowest','least','bottom']):return'min'elifany(wordintextforwordin['filter','find','search','with','containing']):return'filter'else:return'retrieve'defextract_target_value(self,text:str,dataset_name:Optional[str])->Optional[str]:"""Extractthetargetvalue/entityfromthequestion"""ifnotdataset_name:returnNonedf=self.datasets[dataset_name]metadata=self.dataset_metadata[dataset_name]#Commonwordstoignoreignore_words={'the','a','an','and','or','but','in','on','at','to','for','of','with','by','from','up','about','into','through','during','before','after','above','below','between','among','under','over','what','how','when','where','why','which','who','whom','whose','this','that','these','those','i','you','he','she','it','we','they','me','him','her','us','them','my','your','his','its','our','their','show','tell','give','list','find','search','get','want','need','like','can','could','would','should','will','just','only','also','even','still','yet','already','now','then','here','there','very','really','quite','rather','somewhat','more','most','less','least','much','many','few','some','any','all','both','each','every','either','neither'}#Specialhandlingforhealthyfoodrecommendationstext_lower=text.lower()ifdataset_name=='indian_food'andany(keywordintext_lowerforkeywordin['healthy','recommend','suggest','good','best','eat','eating']):return'healthy_foods'#Specialmarkerforhealthyfoodqueries#Lookforexactmatchesintextcolumnsforcolinmetadata['text_columns']:ifcolindf.columns:unique_vals=df[col].dropna().astype(str).unique()forvalinunique_vals:val_lower=str(val).lower()ifval_lowerintextandlen(val)>2:#Avoidveryshortmatches#Checkifthisisameaningfulmatch(notjustacommonword)ifval_lowernotinignore_wordsandlen(val_lower)>3:returnval#Lookforpartialmatches-bemoreselectivewords=[wordforwordintext.split()ifword.lower()notinignore_wordsandlen(word)>2]forwordinwords:forcolinmetadata['text_columns']:ifcolindf.columns:matches=df[df[col].astype(str).str.lower().str.contains(word,na=False)]ifnotmatches.empty:returnword#Tryphrasematchingformulti-wordtermsquestion_words=[wforwintext.split()ifw.lower()notinignore_words]foriinrange(len(question_words)):forjinrange(i+1,min(i+4,len(question_words))):#2-3wordphrasesphrase=''.join(question_words[i:j+1])forcolinmetadata['text_columns']:ifcolindf.columns:matches=df[df[col].astype(str).str.lower().str.contains(phrase,na=False)]ifnotmatches.empty:returnphrasereturnNonedefexecute_dynamic_query(self,intent:Dict[str,Any])->str:"""Executethequerybasedonextractedintent"""dataset_name=intent['target_dataset']ifnotdataset_nameordataset_namenotinself.datasets:returnself.generate_fallback_response(intent)df=self.datasets[dataset_name]operation=intent['operation']try:ifoperation=='retrieve':returnself.handle_retrieve_operation(df,intent,intent['target_value'])elifoperation=='count':returnself.handle_count(df,intent)elifoperation=='filter':returnself.handle_filter(df,intent)elifoperation=='max':returnself.handle_extreme(df,intent,'max')elifoperation=='min':returnself.handle_extreme(df,intent,'min')elifoperation=='average':returnself.handle_aggregation(df,intent,'mean')elifoperation=='sum':returnself.handle_aggregation(df,intent,'sum')else:returnself.handle_retrieve_operation(df,intent,intent['target_value'])exceptExceptionase:returnf"Iencounteredanerrorwhileprocessingyourrequest:{str(e)}"defhandle_retrieve_operation(self,df:pd.DataFrame,intent:Dict[str,Any],target_value:str)->str:"""Handleretrieveoperationswithmultipleresults"""#Specialhandlingforhealthyfoodrecommendationsiftarget_value=='healthy_foods'andintent['target_dataset']=='indian_food':#Gethealthyfoodswithgoodproteinandreasonablecalorieshealthy_foods=df[(df['Protein(g)']>=5)&(df['Calories(kcal)']<=400)&(df['Fibre(g)']>=1)].sort_values('Protein(g)',ascending=False).head(10)ifnothealthy_foods.empty:response="Healthyfoodoptions:\n\n"fori,(_,row)inenumerate(healthy_foods.iterrows()):dish_name=row.get('DishName','Unknown')iflen(dish_name)>15:dish_name=dish_name[:12]+"..."calories=row.get('Calories(kcal)','N/A')protein=row.get('Protein(g)','N/A')response+=f"{i+1}.{dish_name}\n"response+=f"{calories}cal,{protein}gprotein\n\n"returnresponse#Firsttryexactmatchesall_matches=pd.DataFrame()#Searchacrossalltextcolumnsformatchesforcolinself.dataset_metadata[intent['target_dataset']]['text_columns']:ifcolindf.columns:#Exactmatchesfirstexact_matches=df[df[col].astype(str).str.lower()==target_value.lower()]ifnotexact_matches.empty:all_matches=pd.concat([all_matches,exact_matches],ignore_index=True)#Partialmatchespartial_matches=df[df[col].astype(str).str.lower().str.contains(target_value.lower(),na=False)]ifnotpartial_matches.empty:all_matches=pd.concat([all_matches,partial_matches],ignore_index=True)#Removeduplicatesifnotall_matches.empty:all_matches=all_matches.drop_duplicates()#Forfoodrecommendations,showmoreitemsifintent['target_dataset']=='indian_food'andany(keywordintarget_value.lower()forkeywordin['healthy','recommend','suggest','good','best']):#Showtop10healthyoptionsif'Protein(g)'inall_matches.columns:all_matches=all_matches.sort_values('Protein(g)',ascending=False)elif'Calories(kcal)'inall_matches.columns:all_matches=all_matches.sort_values('Calories(kcal)',ascending=True)returnself.format_results(all_matches.head(10),intent,target_value)#Forotherqueries,limittoreasonablenumberreturnself.format_results(all_matches.head(20),intent,target_value)returnself.format_general_info(df,intent)defhandle_filter(self,df:pd.DataFrame,intent:Dict[str,Any])->str:"""Handlefilteroperations"""target_value=intent['target_value']comparisons=intent['comparisons']numbers=intent['numbers']iftarget_value:mask=df.astype(str).apply(lambdax:x.str.lower().str.contains(target_value.lower(),na=False)).any(axis=1)filtered_df=df[mask]#Applynumericfiltersifpresentifnumbersandcomparisons:forcolinfiltered_df.select_dtypes(include=[np.number]).columns:fori,numinenumerate(numbers):ifi<len(comparisons):comp=comparisons[i]ifcomp=='greater_than':filtered_df=filtered_df[filtered_df[col]>num]elifcomp=='less_than':filtered_df=filtered_df[filtered_df[col]<num]elifcomp=='equals':filtered_df=filtered_df[filtered_df[col]==num]ifnotfiltered_df.empty:returnself.format_results(filtered_df,intent,target_value)returnf"Noresultsfoundfor'{target_value}'in{self.get_dataset_display_name(intent['target_dataset'])}."defhandle_count(self,df:pd.DataFrame,intent:Dict[str,Any])->str:"""Handlecountoperations"""target_value=intent['target_value']iftarget_value:mask=df.astype(str).apply(lambdax:x.str.lower().str.contains(target_value.lower(),na=False)).any(axis=1)count=len(df[mask])returnf"Found{count}itemsrelatedto'{target_value}'in{self.get_dataset_display_name(intent['target_dataset'])}."else:returnf"The{self.get_dataset_display_name(intent['target_dataset'])}datasetcontains{len(df)}items."defhandle_extreme(self,df:pd.DataFrame,intent:Dict[str,Any],extreme_type:str)->str:"""Handlemax/minoperations"""target_column=self.identify_target_column(df,intent)iftarget_columnandtarget_columnindf.select_dtypes(include=[np.number]).columns:ifextreme_type=='max':result=df.loc[df[target_column].idxmax()]else:result=df.loc[df[target_column].idxmin()]returnself.format_single_result(result,intent,f"{extreme_type.title()}{target_column}")returnf"Couldn'tfindanumericcolumntofind{extreme_type}valuefor."defhandle_aggregation(self,df:pd.DataFrame,intent:Dict[str,Any],agg_type:str)->str:"""Handleaggregationoperations"""target_column=self.identify_target_column(df,intent)iftarget_columnandtarget_columnindf.select_dtypes(include=[np.number]).columns:ifagg_type=='mean':value=df[target_column].mean()elifagg_type=='sum':value=df[target_column].sum()else:value=df[target_column].mean()returnf"The{agg_type}{target_column}in{self.get_dataset_display_name(intent['target_dataset'])}is{value:.2f}."returnf"Couldn'tfindanumericcolumnfor{agg_type}calculation."defidentify_target_column(self,df:pd.DataFrame,intent:Dict[str,Any])->Optional[str]:"""Identifywhichcolumntooperateon"""keywords=intent['keywords']#Matchkeywordstocolumnsforkeywordinkeywords:forcolindf.columns:ifkeywordincol.lower()orcol.lower()inkeyword:returncol#Defaulttofirstnumericcolumnnumeric_cols=df.select_dtypes(include=[np.number]).columnsiflen(numeric_cols)>0:returnnumeric_cols[0]returnNonedeffind_best_fuzzy_match(self,df:pd.DataFrame,target:str)->Optional[str]:"""Findbestfuzzymatchfortargetindataset"""best_match=Nonebest_score=0forcolindf.select_dtypes(include=['object']).columns:values=df[col].dropna().astype(str).unique()forvalinvalues:val_lower=str(val).lower()target_lower=target.lower()#Simplefuzzymatchingiftarget_lower==val_lower:returnvaleliftarget_lowerinval_lower:score=len(target_lower)/len(val_lower)*100elifval_lowerintarget_lower:score=len(val_lower)/len(target_lower)*100else:#Wordoverlaptarget_words=set(target_lower.split())val_words=set(val_lower.split())overlap=len(target_words.intersection(val_words))total=len(target_words.union(val_words))score=(overlap/total)*100iftotal>0else0ifscore>best_scoreandscore>50:#Minimumthresholdbest_score=scorebest_match=valreturnbest_matchdefformat_results(self,results:pd.DataFrame,intent:Dict[str,Any],target_value:str)->str:"""Formatqueryresults"""dataset_name=intent['target_dataset']limit=min(10,len(results))#Limitto10results#Createamoreuser-friendlytitlebasedonthequerytypeifintent['operation']=='count':returnf"Found{len(results)}itemsmatching'{target_value}'in{self.get_dataset_display_name(dataset_name)}."#Forretrieveoperations,showacleanertitleiflen(results)==1:response=f"{target_value.title()}\n\n"else:response=f"{target_value.title()}Results\n\n"fori,(_,row)inenumerate(results.head(limit).iterrows()):response+=f"{i+1}."#Formatbasedondatasettypeifdataset_name=='exercises':response+=f"{row.get('name','Unknown')}\n"response+=f"Target:{row.get('target','N/A')},Equipment:{row.get('equipment','N/A')}\n"if'instructions'inrowandpd.notna(row['instructions']):response+=f"Instructions:{str(row['instructions'])[:100]}...\n"elifdataset_name=='indian_food':dish_name=row.get('DishName','Unknown')#Truncatelongnamestopreventwrappingiflen(dish_name)>30:dish_name=dish_name[:27]+"..."response+=f"•{dish_name}:{row.get('Calories(kcal)','N/A')}kcal,{row.get('Protein(g)','N/A')}gprotein\n"elifdataset_name=='disease_food':response+=f"{row.get('FoodItem','Unknown')}\n"response+=f"Disease:{row.get('Disease','N/A')},Type:{row.get('RecommendationType','N/A')}\n"response+=f"Calories:{row.get('Calories','N/A')}kcal\n"elifdataset_name=='yoga_poses':response+=f"{row.get('AName','Unknown')}\n"response+=f"Level:{row.get('Level','N/A')}\n"if'Benefits'inrowandpd.notna(row['Benefits']):response+=f"Benefits:{str(row['Benefits'])[:100]}...\n"elifdataset_name=='diet_recommendations':response+=f"Profile:{row.get('age','N/A')}years,{row.get('gender','N/A')}\n"response+=f"Goal:{row.get('goal','N/A')},Diet:{row.get('diet_type','N/A')}\n"if'diet_recommendation'inrowandpd.notna(row['diet_recommendation']):response+=f"Recommendation:{str(row['diet_recommendation'])[:100]}...\n"else:#Genericformattingforcolinresults.columns[:3]:#Showfirst3columnsresponse+=f"{col}:{row.get(col,'N/A')}\n"response+="\n"iflen(results)>limit:response+=f"...and{len(results)-limit}moreitems.\n"returnresponsedefformat_single_result(self,result:pd.Series,intent:Dict[str,Any],context:str)->str:"""Formatasingleresult"""dataset_name=intent['target_dataset']response=f"{context}in{self.get_dataset_display_name(dataset_name)}:\n\n"ifdataset_name=='exercises':response+=f"{result.get('name','Unknown')}\n"response+=f"Target:{result.get('target','N/A')}\n"response+=f"Equipment:{result.get('equipment','N/A')}\n"if'instructions'inresultandpd.notna(result['instructions']):response+=f"Instructions:{result['instructions']}\n"elifdataset_name=='indian_food':response+=f"{result.get('DishName','Unknown')}\n"nutrition_info=[]forcolin['Calories(kcal)','Protein(g)','Carbohydrates(g)','Fats(g)','Fibre(g)','Sodium(mg)']:ifcolinresultandpd.notna(result[col]):nutrition_info.append(f"{col}:{result[col]}")response+=f"Nutrition:{','.join(nutrition_info)}\n"elifdataset_name=='disease_food':response+=f"{result.get('FoodItem','Unknown')}\n"response+=f"Disease:{result.get('Disease','N/A')}\n"response+=f"Recommendation:{result.get('RecommendationType','N/A')}\n"response+=f"Calories:{result.get('Calories','N/A')}kcal\n"elifdataset_name=='yoga_poses':response+=f"{result.get('AName','Unknown')}\n"response+=f"Level:{result.get('Level','N/A')}\n"if'Benefits'inresultandpd.notna(result['Benefits']):response+=f"Benefits:{result['Benefits']}\n"returnresponsedefformat_general_info(self,df:pd.DataFrame,intent:Dict[str,Any])->str:"""Formatgeneralinformationaboutthedataset"""dataset_name=intent['target_dataset']response=f"{self.get_dataset_display_name(dataset_name)}DatasetInformation:\n\n"response+=f"Totalitems:{len(df)}\n"response+=f"Availablecolumns:{','.join(df.columns.tolist())}\n"#Showsomesampledataresponse+=f"\nSampleitems:\n"fori,(_,row)inenumerate(df.head(3).iterrows()):response+=f"{i+1}."ifdataset_name=='exercises':response+=f"{row.get('name','Unknown')}"elifdataset_name=='indian_food':response+=f"{row.get('DishName','Unknown')}"elifdataset_name=='disease_food':response+=f"{row.get('FoodItem','Unknown')}"elifdataset_name=='yoga_poses':response+=f"{row.get('AName','Unknown')}"elifdataset_name=='diet_recommendations':response+=f"{row.get('age','N/A')}y,{row.get('gender','N/A')},{row.get('goal','N/A')}"else:response+=f"Item{i+1}"response+="\n"returnresponsedefget_dataset_display_name(self,dataset_name:str)->str:"""Getuser-friendlydisplaynamefordataset"""display_names={'exercises':'Exercises','indian_food':'IndianFoodNutrition','diet_recommendations':'DietRecommendations','disease_food':'Disease-FoodNutrition','yoga_poses':'YogaPoses'}returndisplay_names.get(dataset_name,dataset_name)defgenerate_fallback_response(self,intent:Dict[str,Any])->str:"""Generateahelpfulfallbackresponse"""response="Icouldn'tfindspecificinformationforyourquery.Here'swhatIcanhelpyouwith:\n\n"response+="\1\n"forname,metadatainself.dataset_metadata.items():response+=f"•{self.get_dataset_display_name(name)}({metadata['num_rows']}items)\n"response+="\n\1\n"response+="•Specificitems(e.g.,'squats','chai','diabetes')\n"response+="•Categories(e.g.,'chestexercises','highproteinfoods')\n"response+="•Comparisons(e.g.,'highestcaloriefoods')\n"response+="•Counts(e.g.,'howmanyexercisesforchest')\n"response+="•Attributes(e.g.,'caloriesinboiledegg')\n"response+="•Numericoperations(e.g.,'averageproteininfoods')\n"response+="•Filtering(e.g.,'foodswithmorethan20gprotein')\n"returnresponsedefanswer_question(self,question:str)->str:"""Mainmethodtoansweranyquestionaboutthedatasetswithdynamicfallback"""ifnotself.datasets:return"Sorry,I'mhavingtroubleloadingmyknowledgebase.Pleasetryagainlater."#Extractintentfromthequestionintent=self.extract_query_intent(question)#Trydataset-basedanswerfirstdataset_response=self.execute_dynamic_query(intent)#Ifdatasetgivesgoodresults,usethemifdataset_responseandnotself.is_dataset_response_empty(dataset_response):#IfLLaMA3isavailable,enhancetheresponseifself.use_llama:ifself.should_use_llama(question,dataset_response):llama_response=self.call_llama3(question,{'dataset_results':dataset_response,'intent':intent})ifllama_response:#CombinedatasetaccuracywithLLaMA3'snaturallanguagereturnf"{dataset_response}\n\n{llama_response}"returndataset_response#Ifdatasetdoesn'thavegoodanswer,usedynamicintelligentfallbackdynamic_response=self.generate_dynamic_response(question,intent)ifdynamic_response:returndynamic_response#IfLLaMA3isavailable,tryitasfinalfallbackifself.use_llama:llama_response=self.call_llama3(question,{'dataset_results':"Nospecificdatafoundindatasets",'intent':intent})ifllama_response:returnllama_response#Finalfallbackwithhelpfulgeneralresponsereturnself.generate_helpful_fallback(question,intent)defis_dataset_response_empty(self,response:str)->bool:"""Checkifdatasetresponseisessentiallyemptyornothelpful"""empty_indicators=["noresultsfound","notfoundindataset","nodataavailable","sorry,icouldn'tfind","idon'thaveinformation","nomatchingresults","icouldn'tfindspecificinformationforyourquery","here'swhaticanhelpyouwith:","availabledatasets:","youcanaskabout:"]response_lower=response.lower()returnany(indicatorinresponse_lowerforindicatorinempty_indicators)defgenerate_dynamic_response(self,question:str,intent:Dict)->str:"""Generateintelligentresponsesforcommonfitnessquestionsnotindatasets"""question_lower=question.lower()#Weightmanagementquestionsifany(keywordinquestion_lowerforkeywordin['loseweight','weightloss','reduceweight']):returnself.generate_weight_loss_advice(question_lower,intent)#Musclegainquestionselifany(keywordinquestion_lowerforkeywordin['gainmuscle','buildmuscle','musclegrowth']):returnself.generate_muscle_gain_advice(question_lower,intent)#Workoutroutinequestionselifany(keywordinquestion_lowerforkeywordin['workoutroutine','exerciseplan','fitnessplan']):returnself.generate_workout_routine_advice(question_lower,intent)#Nutritionadvicequestionselifany(keywordinquestion_lowerforkeywordin['healthydiet','nutritionadvice','eatinghealthy']):returnself.generate_nutrition_advice(question_lower,intent)#Beginnerquestionselifany(keywordinquestion_lowerforkeywordin['beginner','gettingstarted','newtofitness']):returnself.generate_beginner_advice(question_lower,intent)#Injurypreventionquestionselifany(keywordinquestion_lowerforkeywordin['injury','pain','hurt','safety']):returnself.generate_injury_prevention_advice(question_lower,intent)#Motivationquestionselifany(keywordinquestion_lowerforkeywordin['motivation','staymotivated','consistent']):returnself.generate_motivation_advice(question_lower,intent)#Time-basedworkoutquestionselifany(keywordinquestion_lowerforkeywordin['howlong','time','duration','minutes']):returnself.generate_time_based_advice(question_lower,intent)#Equipmentquestionselifany(keywordinquestion_lowerforkeywordin['equipment','gym','homeworkout','noequipment']):returnself.generate_equipment_advice(question_lower,intent)#Progresstrackingquestionselifany(keywordinquestion_lowerforkeywordin['progress','track','measure','results']):returnself.generate_progress_tracking_advice(question_lower,intent)returnNonedefgenerate_weight_loss_advice(self,question:str,intent:Dict)->str:"""Generateweightlossadvice"""advice=["Foreffectiveweightloss,Irecommendacombinationofregularexerciseandabalanceddiet.","","ExerciseTips:","•Aimfor150-300minutesofmoderate-intensitycardioperweek","•Includestrengthtraining2-3timesperweektomaintainmusclemass","•Tryactivitieslikebriskwalking,cycling,swimming,orjogging","•Startwith30minutesdailyandgraduallyincreaseduration","","NutritionTips:","•Createamoderatecaloriedeficit(500-750calorieslessthanmaintenance)","•Focusonwholefoods:leanproteins,vegetables,fruits,andwholegrains","•Drinkplentyofwater(8-10glassesdaily)","•Limitprocessedfoods,sugar,andexcessivesaturatedfats","","Remember:Sustainableweightlossistypically0.5-1kgperweek.Consistencyismoreimportantthanperfection!"]if'fast'inquestionor'quick'inquestion:advice.append("\nNote:Rapidweightloss(>1kg/week)isoftenunsustainableandcanbeunhealthy.Focusonlong-termlifestylechanges.")return"\n".join(advice)defgenerate_muscle_gain_advice(self,question:str,intent:Dict)->str:"""Generatemusclegainadvice"""advice=["Tobuildmuscleeffectively,youneedproperresistancetraining,adequateprotein,andsufficientrecovery.","","TrainingPrinciples:","•Progressiveoverload:graduallyincreaseweight,reps,orsets","•Focusoncompoundexercises:squats,deadlifts,benchpress,rows","•Traineachmusclegroup2-3timesperweek","•Aimfor8-12repspersetforhypertrophy(musclegrowth)","•Rest60-90secondsbetweensets","","NutritionforMuscleGrowth:","•Consume1.6-2.2gofproteinperkgofbodyweightdaily","•Eatinaslightcaloriesurplus(300-500caloriesabovemaintenance)","•Includeproteinsources:chicken,fish,eggs,dairy,legumes,tofu","•Timeproteinintake:havesomewithin2hourspost-workout","","RecoveryisCrucial:","•Get7-9hoursofqualitysleeppernight","•Allow48hoursbetweentrainingthesamemusclegroup","•Considerrestdaysanddeloadweeks"]return"\n".join(advice)defgenerate_workout_routine_advice(self,question:str,intent:Dict)->str:"""Generateworkoutroutineadvice"""#Checkiftheywantaspecificdurationif'30minute'inquestionor'30min'inquestion:routine=self.generate_30min_workout()elif'45minute'inquestionor'45min'inquestion:routine=self.generate_45min_workout()elif'1hour'inquestionor'60minute'inquestionor'1hr'inquestion:routine=self.generate_60min_workout()else:routine=self.generate_general_workout_routine()returnroutinedefgenerate_30min_workout(self)->str:return"""Here'saneffective30-minuteworkoutroutine:30-MinuteFullBodyWorkoutWarm-up(5minutes):•Jumpingjacks-2minutes•Armcirclesandlegswings-3minutesMainWorkout(20minutes):•Bodyweightsquats-3setsof15reps•Push-ups(modifyasneeded)-3setsof10reps•Plankhold-3setsof30seconds•Lunges-3setsof12repsperleg•Jumpingjacks-2minutesCool-down(5minutes):•Fullbodystretches-5minutesThisroutinehitsallmajormusclegroupsandcanbedoneanywhere!"""defgenerate_45min_workout(self)->str:return"""Here'sacomprehensive45-minuteworkoutroutine:45-MinuteSplitRoutineWarm-up(5minutes):•Lightcardio(jogginginplace)-3minutes•Dynamicstretches-2minutesUpperBody(15minutes):•Push-ups-3setsof12reps•Dumbbellrows(orresistancebands)-3setsof12reps•Shoulderpress-3setsof10reps•Bicepcurls-3setsof12repsLowerBody(15minutes):•Squats-3setsof15reps•Lunges-3setsof12repsperleg•Calfraises-3setsof15reps•Glutebridges-3setsof15repsCore&Cool-down(10minutes):•Plank-3setsof45seconds•Crunches-3setsof15reps•Fullbodystretching-5minutesPerfectforbuildingstrengthandmuscle!"""defgenerate_60min_workout(self)->str:return"""Here'sanintensive60-minuteworkoutroutine:60-MinuteAdvancedFullBodyWorkoutWarm-up(10minutes):•Lightcardio-5minutes•Dynamicstretchingandmobility-5minutesStrengthTraining(35minutes):•Squats-4setsof12reps•Benchpress-4setsof10reps•Deadlifts-3setsof8reps•Pull-ups(orlatpulldowns)-3setsof8reps•Shoulderpress-3setsof10reps•Barbellrows-3setsof10repsCardioFinisher(10minutes):•HIIT:30secondssprint,30secondsrestx10roundsCool-down(5minutes):•FullbodystretchingandfoamrollingThisroutineprovidesmaximumresultsforstrengthandcardiovascularfitness!"""defgenerate_general_workout_routine(self)->str:return"""Here'sabalancedworkoutroutineyoucanfollow:WeeklyWorkoutStructureMonday-UpperBody:•Push-ups,rows,shoulderpress,bicepcurls,tricepdipsTuesday-LowerBody:•Squats,lunges,deadlifts,calfraises,legpressWednesday-CardioorRest:•Running,cycling,swimming,oractiverecoveryThursday-UpperBody:•DifferentexercisesthanMondaytopreventboredomFriday-LowerBody:•FocusondifferentmovementsthanTuesdaySaturday-FullBodyorCardio:•YourchoicebasedonenergylevelsSunday-Rest:•LightwalkingorstretchingoptionalKeyPrinciples:•Eachworkout:45-60minutes•Rest60-90secondsbetweensets•Progressivelyincreaseweight/difficulty•Listentoyourbodyandadjustasneeded"""defgenerate_nutrition_advice(self,question:str,intent:Dict)->str:"""Generatenutritionadvice"""return"""Here'scomprehensivenutritionadviceforoptimalhealthandfitness:BalancedNutritionPrinciplesMacronutrients:•Protein:1.6-2.2gperkgbodyweight(musclerepair/growth)•Carbs:45-65%ofdailycalories(energyforworkouts)•Fats:20-35%ofdailycalories(hormoneproduction,vitaminabsorption)MealTiming:•Pre-workout:Carbs+protein1-2hoursbeforeexercise•Post-workout:Protein+carbswithin2hoursafterexercise•Throughoutday:Eatevery3-4hourstomaintainenergySuperfoodstoInclude:•Proteins:Chicken,fish,eggs,Greekyogurt,legumes,tofu•Carbs:Oats,quinoa,sweetpotatoes,brownrice,fruits•Fats:Avocado,nuts,seeds,oliveoil•Vegetables:Leafygreens,broccoli,colorfulvegetablesHydration:•8-10glassesofwaterdaily•Moreifexercisingintensely•Monitorurinecolor(paleyellowisideal)Supplements(Optional):•VitaminD(especiallyiflimitedsunexposure)•Omega-3fattyacids•Considercreatineforstrength/performancegoalsRemember:Consistencyismoreimportantthanperfection.Focusonprogress,notperfection!"""defgenerate_beginner_advice(self,question:str,intent:Dict)->str:"""Generatebeginnerfitnessadvice"""return"""Welcometoyourfitnessjourney!Here'severythingyouneedtoknowasabeginner:GettingStartedGuideWeek1-2:FoundationBuilding•Startwith3daysperweek,30minutespersession•Focusonlearningproperformratherthanintensity•Bodyweightexercisesareperfecttostart•Example:squats,push-ups(onkneesifneeded),planks,lungesWeek3-4:BuildingConsistency•Increaseto4daysperweek•Graduallyincreasedurationto45minutes•Startaddinglightweightsorresistancebands•TrydifferentactivitiestofindwhatyouenjoyEssentialTipsforBeginners:1.StartSlow:Yourbodyneedstimetoadapt2.FocusonForm:Qualityoverquantitypreventsinjuries3.ListentoYourBody:Somesorenessisnormal,painisnot4.StayHydrated:Drinkwaterbefore,during,andafterworkouts5.TrackProgress:Takephotosandmeasurements,notjustweightCommonBeginnerMistakestoAvoid:•Doingtoomuchtoosoon(leadstoburnout)•Comparingyourselftoothers•Skippingwarm-upsandcool-downs•Notfuelingproperlybefore/afterworkouts•ExpectingimmediateresultsRemember:Everyexpertwasonceabeginner.Bepatientwithyourselfandcelebratesmallvictoriesalongtheway!"""defgenerate_injury_prevention_advice(self,question:str,intent:Dict)->str:"""Generateinjurypreventionadvice"""return"""Injurypreventioniscrucialforlong-termfitnesssuccess.Here'showtostaysafe:\1\1•Alwayswarmupfor5-10minuteswithlightcardio•Dodynamicstretches(armcircles,legswings)•Checkequipmentforsafetyandpropersetup\1•Maintainproperform-qualityoverquantity•Don'tlifttooheavytoosoon(progressiveoverload)•Listentoyourbody-stopifyoufeelsharppain•Useappropriatesafetyequipment(spotter,belts,etc.)\1•\1Corestrengthening,properliftingform•\1Propersquat/lungeform,avoidexcessivedepth•\1Balancedtraining,avoidoveruse•\1Properalignment,strengthensupportingmuscles\1•Sharp,stabbingpain(differentfrommusclesoreness)•Swellingorvisibleinflammation•Inabilitytomaintainproperform•Dizzinessorlightheadedness\1•Allow48hoursbetweentrainingsamemusclegroups•Get7-9hoursofqualitysleep•Stayhydratedandeatproperly•Considerfoamrollingandstretching\1•Painthatdoesn'timproveafter2-3daysofrest•Inabilitytomoveabodypartnormally•Severeswellingorbruising•Anyinjuryaffectingdailyactivities\1Adayofrestisbetterthanamonthofrecoveryfrominjury!"""defgenerate_motivation_advice(self,question:str,intent:Dict)->str:"""Generatemotivationadvice"""return"""Stayingmotivatedisoneofthebiggestfitnesschallenges.Hereareprovenstrategies:\1\1•\1"Iwanttolose5kg"vs"Iwanttoloseweight"•\1Trackprogresswithnumbers,photos,measurements•\1Setrealistictargets(0.5-1kgweightlossperweek)•\1GoalsshouldmattertoYOUpersonally•\1Setdeadlines(3months,6months,etc.)\1•Findaworkoutpartnerorjoinfitnesscommunities•Shareyourgoalswithfriends/family•Usefitnessappstotrackprogress•Considerhiringatrainerforguidance\1•Chooseexercisesyouactuallylike•Createmotivatingplaylists•Rewardyourselfforreachingmilestones•Trynewactivitiestopreventboredom\1•Scheduleworkoutslikeappointments•Layoutworkoutclothesthenightbefore•Startwithjust10minutesifyou'renotfeelingmotivated•Focusonshowingup,notonperformance\1•Increasedenergylevels•Bettersleepquality•Clothesfittingdifferently•Improvedmoodandmentalhealth•Increasedstrengthorendurance\1•Writedownyourreasonsforstarting•Reviewthemwhenmotivationdips•Connectfitnesstoyourbiggerlifegoals•Rememberthatprogressisn'talwayslinear\1•Onemissedworkoutdoesn'truinprogress•Focusonconsistency,notperfection•Bekindtoyourselfduringsetbacks•Rememberwhyyoustartedondifficultdays\1"""defgenerate_time_based_advice(self,question:str,intent:Dict)->str:"""Generatetime-basedworkoutadvice"""return"""Here'showtooptimizeyourworkoutdurationbasedonyourgoalsandschedule:\1\1•\130minutes,5daysperweek•\145-60minutes,4-5daysperweek•Includebothcardioandstrengthtraining•HIITworkoutscanbeeffectiveinjust20-25minutes\1•\145-60minutesperworkout•\14-5daysperweek(splitroutines)•\148hoursbetweentrainingsamemusclegroups•Qualityoverquantity-intensefocusedsessions\1•\130minutes,3daysperweek•\145minutes,4daysperweek•Mixofcardio,strength,andflexibilitywork\1•\120minutes=40minutesofsteadycardio•\1Pairexercisesback-to-back(saves15-20minutes)•\1Fullbodyin30minutes•\1Workmultiplemusclessimultaneously\1•\1HIIT+corework•\1Fullbodystrengthcircuit•\1Splitroutine(upper/lowerbody)•\1Comprehensivestrength+cardio\1Consistencybeatsduration.30minutes4xperweekisbetterthan2hours1xperweek.\1"""defgenerate_equipment_advice(self,question:str,intent:Dict)->str:"""Generateequipment-basedworkoutadvice"""return"""Hereareworkoutoptionsfordifferentequipmentscenarios:\1\1•Push-ups(modifyonkneesifneeded)•Squatsandlunges•Planksandmountainclimbers•Burpeesandjumpingjacks•Tricepdipsusingchairs/benches•Pull-upsusingsturdydoorbars\1•Warm-up:5minutesjumpingjacks•Circuit:Push-ups,squats,planks,lunges(45seceach,15secrest)•Repeatcircuit3-4times•Cool-down:5minutesstretching\1\1•Bicepcurlsandtricepextensions•Shoulderpressesandlateralraises•Bent-overrowsandbackexercises•Glutebridgeswithresistance•Calfraiseswithweights\1\1•Barbellcompoundlifts(squat,deadlift,benchpress)•Cablemachinesforisolationexercises•Cardiomachines(treadmill,elliptical,rower)•Smithmachineforguidedmovements•Variousbenchesandspecializedequipment\11.\1($10-20)-Fullbodyworkouts2.\1($50-100)-Progressiveoverload3.\1($20-40)-Upperbodydevelopment4.\1($15-25)-Comfortandsafety\1Youcangetgreatresultswithminimalequipment.Consistencyandproperformmattermorethanfancyequipment!"""defgenerate_progress_tracking_advice(self,question:str,intent:Dict)->str:"""Generateprogresstrackingadvice"""return"""Effectiveprogresstrackingiskeytolong-termsuccess.Here'showtodoitright:\1\1•Bodyweight(sametime,samedayweekly)•Bodymeasurements(waist,hips,chest,arms,thighs)•Progressphotos(front,side,backmonthly)•Bodyfatpercentage(ifavailable)\1•Strength:weightslifted,repscompleted•Cardio:distance,time,heartrate•Flexibility:rangeofmotionmeasurements•Endurance:howlongyoucansustainactivities\1•Energylevelsthroughouttheday•Sleepqualityimprovements•Clothesfittingdifferently•Moodandmentalclarity•Dailyactivitylevels\1\1•Fitnessapps(MyFitnessPal,Strong,Jefit)•Smartwatchesandfitnesstrackers•Progressphotosinphonegallery•Spreadsheetfordetailedtracking\1•Workoutjournal•Measurementtape•Progressphotoprintedandcompared•Calendarcheckmarksforconsistency\1\1•Workoutcompletion•Howyoufeltduring/afterexercise•Energyandmoodlevels\1•Bodyweight(sameday/time)•Measurements(ifdesired)•Reviewweeklyprogress\1•Progressphotos•Bodymeasurements•Reassessgoalsandadjustplans\1\1•"Increasesquatweightby10kgin8weeks"•"Lose2inchesfromwaistin3months"•"Run5kwithoutstoppingin6weeks"•"Exercise4xperweekfor8weeksstraight"\1Progressisn'talwayslinear.Focusontrendsovertime,notdailyfluctuations!"""defgenerate_helpful_fallback(self,question:str,intent:Dict)->str:"""Generateahelpfulfallbackresponsewhennospecificanswerisavailable"""returnf"""Iunderstandyou'reaskingabout:"{question}"WhileIdon'thavespecificinformationaboutthisinmycurrentdatabase,Icanhelpwithmanyfitnessandnutritiontopics!\1•Workoutroutinesandexerciseplans•Nutritionadviceandhealthyeating•Weightlossandmusclegainstrategies•Beginnerfitnessguidance•Injurypreventiontips•Motivationandconsistencystrategies•Progresstrackingmethods•Equipmentrecommendations\1•"Howtoloseweighteffectively"•"Bestexercisesformusclegain"•"Healthymealplanning"•"Beginnerworkoutroutine"•"Howtostaymotivated"•"Injurypreventiontips"\1Youcanalsoaskmeaboutspecificexercises,foods,ornutritionalinformation,andI'llsearchmyextensivedatabaseforyou."""defshould_use_llama(self,question:str,dataset_response:str)->bool:"""DetermineifLLaMA3shouldbeusedforthisquery"""#Don'tuseLLaMAforsimplefactualqueriesifany(keywordinquestion.lower()forkeywordin['caloriesin','proteinin','howmany','list','show','count']):returnFalse#UseLLaMAforcomplexqueries,advice,orexplanationsifany(keywordinquestion.lower()forkeywordin['why','howto','explain','benefits','recommend','suggest','advice','tips','guide','helpme','whatshould','bestway']):returnTrue#UseLLaMAifdatasetresponseisgeneric/fallbackif"couldn'tfind"indataset_response.lower()or"availabledatasets"indataset_response.lower():returnTrue#DefaulttonotusingLLaMAforfasterresponsesreturnFalse#Globalinstancechatbot_instance=Nonedefget_chatbot(use_llama=False,ollama_url="http://localhost:11434"):"""GetorcreatetheglobalchatbotinstancewithoptionalLLaMA3"""globalchatbot_instanceifchatbot_instanceisNone:chatbot_instance=FitnessChatbot(use_llama=use_llama,ollama_url=ollama_url)returnchatbot_instancedefanswer_fitness_question(question:str,use_llama=False,ollama_url="http://localhost:11434")->str:"""Mainfunctiontoansweranyfitness-relatedquestiondynamicallywithLLaMA3option"""bot=get_chatbot(use_llama=use_llama,ollama_url=ollama_url)returnbot.answer_question(question)defenable_llama_integration(ollama_url="http://localhost:11434"):"""EnableLLaMA3integrationforenhancedresponses"""globalchatbot_instancechatbot_instance=FitnessChatbot(use_llama=True,ollama_url=ollama_url)returnchatbot_instance.use_llamadefdisable_llama_integration():"""DisableLLaMA3integrationandusedataset-onlymode"""globalchatbot_instancechatbot_instance=FitnessChatbot(use_llama=False)returnnotchatbot_instance.use_llama